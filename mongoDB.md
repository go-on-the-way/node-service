### 什么是MongoDB？
MongoDB是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统

### 特点
- MongoDB是一个面向文档存储的数据库
- 可以在MongoDB记录中设置任何属性的索引，实现更快的排序
- 可以通过本地或者网络创建数据镜像，使得MongoDB有更强的扩展性
- 通过分片(数据可以分布在计算机网络中的其他节点上)增加负载能力
- Mongo支持丰富的查询表达式
- ...

### 注意
- mongodb不支持事务，所以，无论什么设计，都不要要求mongodb保证数据的完整性。
- mongodb提供许多原子操作，比如文档的保存、修改、删除等，所谓原子操作就是要么文档保存到mongodb,要么没有保存到mongodb,不会出现查询到的文档没有保存完整的情况

### 概念
- 主键/mongodb自动将_id字段设为主键
- 索引/index，索引是特殊的数据结构，索引存储在一个易于遍历读取的数据集合中，索引是对数据库表中一列或多列的值进行排序的一种结构
- 域/field
- 文档/document
- 集合/collection
- 数据库/database

---

### 数据库
- 一个mongodb中可以建立多个数据库
- MongoDB的默认数据库为"db"，该数据库存储在data目录中
- MongoDB的单个实例可以容纳多个独立的数据库，每一个都有自己的集合和权限，不同的数据库也放置在不同的文件中
- 操作命令：
    -   show dbs：显示所有数据库
    -   db：显示当前数据库
    -   use xxxdb：连接到指定的数据库，如果不存在则创建数据库
    -   db.dropDatabase()：删除当前数据库
- 保留数据库名：
    -   admin： 从权限的角度来看，这是"root"数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。
    -   local：这个数据库永远不会被复制，可以用来存储限于本地单台服务器的任意集合
    -   config：当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息

### 文档
文档是一组键值对。MongoDB 的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是 MongoDB 非常突出的特点。服务程序：mongod,客户端程序：mongo。

需要注意的是：
1. 文档中的键/值对是有序的
2. 文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档）
3. MongoDB区分类型和大小写
4. MongoDB的文档不能有重复的键
5. 文档的键是字符串。

文档键命名规范：
- 键不能含有\0(空字符)。这个字符用来表示键的结尾。
- .和$有特别的意义，只有在特定环境下才能使用
- 以下划线"_"开头的键是保留的(不是严格要求的)

### 集合
集合就是MongoDB文档组，类似于关系型数据库中的表格。  
集合存在于数据库中，集合没有固定的结构，这意味着你在对集合可以插入不同格式和类型的数据。  
所有存储在集合中的数据都是 BSON 格式。  
BSON 是一种类似 JSON 的二进制形式的存储格式，是 Binary JSON 的简称。
#### capped collections
Capped collections 就是固定大小的collection。  
Capped collection 是按照文档的插入顺序而不是使用索引确定插入位置，这样的话可以提高增添数据的效率。  
使用 Capped Collection 不能删除一个文档，可以使用 drop() 方法删除 collection 所有的行。  
在32bit机器中，capped collection 最大存储为 1e9( 1X109)个字节。

### 元数据
数据库的信息是存储在集合中的。它们使用了系统的命名空间：dbname.system.*  
对于修改系统集合中的对象有如下限制。  
- 在{{system.indexes}}插入数据，可以创建索引。但除此之外该表信息是不可变的(特殊的drop index命令将自动更新相关信息)。
- {{system.users}}是可修改的。 {{system.profile}}是可删除的。

### MongoDB数据类型
- String,UTF-8编码的字符串才是合法的
- Integer,32或64位
- Boolean,布尔值
- Double,双精度浮点值。用于存储浮点值
- Min/Max keys,将一个值与 BSON（二进制的 JSON）元素的最低值和最高值相对比
- Array,用于将数组或列表或多个值存储位一个键
- Timestamp,时间戳
- Object,用于内嵌文档
- Null,用于创建空值
- Symbol
- Date
- Object ID,对象ID。用于创建文档的ID。通过ObjectId()创建,ObjectId包含12字节,前4个字节表示时间戳，接着3个字节表示机器标识码，然后2个字节表示进程id,最后三个字节是随机数。
- Binary Data,二进制数据。用于存储二进制数据
- Code 代码类型。用于在文档中存储JavaScript代码
- Regular expression,正则表达式类型，用于存储正则表达式

---
### 索引最大范围
- 集合中索引不能超过64个
- 索引名的长度不能超过128个字符
- 一个复合索引最多可以有31个字符